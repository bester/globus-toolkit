GSI_DEVELOPMENT_PATH	=	@GLOBUS_DEV_PATH@

include $(GSI_DEVELOPMENT_PATH)/etc/makefile_header

LINK		=	$(CC)

GSI_SOCKET_CFLAGS	=	-DGSI_SOCKET_SSLEAY $(CFLAGS) -Wall
####

TARGETS	=	gsi-socket-test myproxy-init myproxy-destroy myproxy-get-delegation myproxy-server

COMMON_OBJS	= myproxy.o gsi_socket.o gnu_getopt.o gnu_getopt_long.o
INIT_OBJS	= myproxy_init.o $(COMMON_OBJS)
DESTROY_OBJS	= myproxy_destroy.o $(COMMON_OBJS) 
GET_OBJS	= myproxy_get_delegation.o $(COMMON_OBJS)
SERVER_OBJS	= myproxy_server.o verror.o myproxy_creds.o \
			myproxy_log.o vparse.o myproxy_server_config.o \
			$(COMMON_OBJS)

default:	$(TARGETS)

gsi-socket-test: gsi_socket_test.o gsi_socket.o
	$(LINK) $(LDFLAGS) $(GLOBUS_GSSAPI_LDFLAGS) \
		-o $@ $^ $(GLOBUS_GSSAPI_LIBS)

gsi_socket.o: gsi_socket.c
	$(CC) $(GSI_SOCKET_CFLAGS) -c $<

myproxy-init: $(INIT_OBJS)
	$(LINK) $(LDFLAGS) $(GLOBUS_GSSAPI_LDFLAGS) \
		-o $@ $^ $(GLOBUS_GSSAPI_LIBS)

myproxy-destroy: $(DESTROY_OBJS)
	$(CC) $(LDFLAGS) $(GLOBUS_GSSAPI_LDFLAGS) \
		-o $@ $^ $(GLOBUS_GSSAPI_LIBS)

myproxy-get-delegation: $(GET_OBJS)
	$(CC) $(LDFLAGS) $(GLOBUS_GSSAPI_LDFLAGS) \
		-o $@ $^ $(GLOBUS_GSSAPI_LIBS)

myproxy-server: $(SERVER_OBJS)
	$(CC) $(LDFLAGS) $(GLOBUS_GSSAPI_LDFLAGS) \
		-o $@ $^ $(GLOBUS_GSSAPI_LIBS)

myproxy.o: myproxy.c myproxy.h

myproxy_creds.o: myproxy_creds.c myproxy_creds.h

gnu_getopt.o: gnu_getopt.c

gnu_getopt_long.o: gnu_getopt_long.c

clean:
	rm -f *.o *~
	rm -f $(TARGETS)
